<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>

    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/cart.css">
    <link rel="stylesheet" href="css/item.css">
    <link rel="stylesheet" href="css/additem.css">
</head>

<body>
<div id="templates">
    <div id='item-component' class="template">
        <span class="item-component-container">
            <h3 class="item-title">{{ title }}</h3>
            <h3 class="item-price">{{ setFormatPrice() }}kr</h3>
            <p class="item-description">{{ description }}</p>
            <span class="item-crud-container">
                <button id="item-crud-button-edit" class="item-crud-button" v-onclick="editclick">Edit</button>
                <button id="item-crud-button-remove" class="item-crud-button" v-onclick="removeclick">Remove</button>
            </span>
        </span>  
    </div>
    <div id="cart-component" class="template">
        <ul class="cart-component-ul">
            <li class="cart-component-li" v-for="item in items">
                <item 
                    v-bind:title="item.title"
                    v-bind:description="item.description"
                    v-bind:price="item.price"

                    v-on:editclick="onEditClick",
                    v-on:removeclick="onRemoveClick",

                    class="cart-component-item"
                />
            </li>
        </ul>
    </div>  
    <div id="add-item-component" class="template">
        <form class="add-item-component-form" onsubmit="onSubmit">
            <input id="title" class="add-item-component-form-item" name="title" type="text" placeholder="Name" v-bind:title>
            <input id="price" class="add-item-component-form-item" name="price" type="number" placeholder="Price" v-bind:price>
            <input id="description" class="add-item-component-form-item" name="description" type="text" placeholder="Description" v-bind:description>
            <button id="submitButton" class="add-item-component-form-submit" name="submitButton" type="submit">Submit</button>
        </form>
    </div>
</div>

<div id="vueContent">
    <cart v-bind:items="items" />

</div>

</body>

<script>
class Item {
    /**@param {string} name
     * @param {string} description
     * @param {string} price*/
    constructor(name, description, price) {
        this.title = name;
        this.description = description;
        this.price = price;
    }
}

Vue.component('item', {
    props: ['title', 'description', 'price'],
    template: document.getElementById('item-component'),
    methods: {
        setFormatPrice() {
            let result = ""; 
            let price = this.price.toString().split('').reverse().join(''); //Reverse price string
            for (let i = price.length - 1; i >= 0; i--) { //Make for-reverse
                result += price[i]; //Insert number
                if (i % 3 == 0 && i != 0) //If number is a 3rd
                    result +='.';   //Insert .
            }
            return result; //Return something like '1.000.000'
        },
        editclick() { this.$emit('editclick', this); },
        removeclick() { this.$emit('removeclick', this); }
    }
});
Vue.component('cart', {
    props: ['items'],
    template: document.getElementById('cart-component'),
    methods: {
        /**@param {Item} item*/
        onEditClick(item) {
            let bindings = ['title', 'price', 'description'].map(name => `v-bind:name=${item[name]}`).join(' ');
            document.write(`<add-item on:submit="onSubmit" ${bindings}/>`);

            let itemIndex = this.items.indexOf(item);
            this.items[itemIndex] = item;
        },
        onRemoveClick(item) {
            this.items = this.items.filter(i => i != item);
        },
        onSubmit(result) {
            console.log(result);
        }
    }
});
Vue.component('add-item', {
    template: document.getElementById('add-item-component'),
    props: ['title', 'description', 'price'],
    methods: {
        onSubmit(result) { this.$emit('submit', result); }
    }
});

const vue = new Vue({
    el: "#vueContent",
    data: {
        items: [
            new Item('Omega comforable chair', "You won't believe your ass, when you sit on it", 50),
            new Item('Real working desk', "So far, it hasn't broken down yet so uh", 100),
            new Item("Your bed", "Yes. We have your bed and we require you to pay for it back", 1000000)
        ]
    }
})
</script>

</html>